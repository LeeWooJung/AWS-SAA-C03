# Config Rules

AWS Config Rules는 **AWS 리소스의 구성을 평가하고 특정 요구사항이나 규정 준수 기준을 충족하는지 확인하는 데 사용되는 규칙**임. 

이를 통해 사용자는 **자동으로 리소스의 구성 상태를 평가하고, 규정 준수 상태를 지속적으로 모니터링**할 수 있음. 

AWS Config Rules는 **사전 정의된 규칙과 사용자 정의 규칙을 모두 지원**함.

AWS Config Rules는 규정을 벗어나는 것을 확인할 뿐 **현재 진행되고 있는 Action을 멈추지 않음**.

## 특징

### 사전 정의된 규칙

AWS에서 제공하는 규칙 템플릿을 사용하여 쉽게 규칙을 설정할 수 있음.

### 사용자 정의 규칙

특정 요구사항에 맞게 사용자 정의 규칙을 작성할 수 있음.

**AWS Lambda**에서 정의되어야 함.

* **Example**

    * 각 EBS Disk가 GP2 Type인지 평가
    * 각 EC2 Instance가 t2.micro인지 평가

### 자동 평가

리소스의 구성 상태가 변경될 때마다 규칙을 자동으로 평가함.

### 실시간 모니터링

실시간으로 규정 준수 상태를 모니터링하여 빠르게 대응할 수 있음.

### 통합 알림

**규칙 위반 시 SNS 주제를 통해 알림을 전송하거나, Lambda 함수를 호출하여 자동화된 작업**을 수행할 수 있음.

### 규정 준수 보고

규정 준수 상태를 보고서 형태로 제공하여 감사 및 컴플라이언스 요구사항을 충족함.

## 구성요소

* **AWS 관리 규칙**

    AWS에서 제공하는 사전 정의된 규칙으로, 일반적인 보안, 비용 최적화, 성능 등의 요구사항을 평가함.

* **사용자 정의 규칙**

    사용자 요구사항에 맞게 작성된 Lambda 함수를 통해 특정 요구사항을 평가하는 규칙임.

* **규칙 평가 결과**

    규칙 평가 결과를 통해 리소스가 규정을 준수하는지, 아니면 위반했는지 확인할 수 있음.

* **자동 수정**

    규칙 위반 시 자동으로 수정 작업을 수행하여 규정 준수를 유지할 수 있음.

## Pricing

AWS Config Rules의 가격 정책은 다음과 같은 주요 요소에 따라 결정됨.

### Config Rule Evaluations

* **활성 Config 규칙 평가** (Active Config Rule Evaluations)

    Config 규칙이 활성화된 상태에서 리소스의 구성 상태를 **평가할 때마다 비용이 발생**함.

* **가격**

    규칙 평가 1회당 $0.001

### Configuration Items Recorded

* **구성 항목 기록** (Configuration Items Recorded)

    AWS 리소스의 구성 **변경 사항이 기록될 때마다 비용이 발생**함.

* **가격**

    구성 항목 기록 1개당 $0.003

### Custom Rules

* **사용자 정의 규칙** (Custom Rules)

    **Lambda 함수를 사용하여 사용자 정의 규칙을 평가할 때 발생하는 비용**임.

    Lambda 호출 비용과 S3 및 CloudWatch에 기록되는 데이터 비용이 추가로 발생할 수 있음.

### 주의사항

* **무료 사용 범위**

    AWS Config에는 **무료 사용 범위가 제공되지 않음**. 

    모든 구성 항목 기록 및 규칙 평가에 대해 비용이 발생함.

* **비용 예측**

    사용량에 따라 비용이 크게 달라질 수 있으므로, 사용량을 정확히 예측하여 비용을 관리하는 것이 중요함.

*  **비용 관리**

    **AWS 비용 탐색기 및 비용 할당 태그**를 사용하여 AWS Config 사용 비용을 모니터링하고 관리할 수 있음.

## Remediations

AWS Config Rules의 Remediations은 **규칙 위반을 자동으로 수정하여 AWS 리소스가 규정 준수 상태를 유지할 수 있도록 도와주는 기능**임. 

이 기능은 자동화된 조치를 통해 규정 준수 상태를 유지하고 **수동 개입을 최소화**하는 데 유용함.

**Lambda 함수를 통해 사용자 정의 스크립트로 실행**되거나 **AWS Systems Manager Automation을 통해 사전 정의된 작업을 수행**함.

Resource가 Remediation 후에도 아직 규정 등을 준수하지 못하고 있다면, **Remediation Retries**를 설정할 수 있음.

### 특징

* **자동화된 수정**

    규칙 위반을 감지할 때마다 자동으로 수정 작업을 실행함.

* **사전 정의된 작업**

    **AWS Systems Manager Automation을 사용하여 사전 정의된 작업을 실행**할 수 있음.

* **사용자 정의 작업**

    **Lambda 함수를 사용하여 사용자 정의 스크립트를 실행**할 수 있음.

* **실시간 대응**

    규정 위반을 감지한 즉시 수정 작업을 수행하여 빠른 대응이 가능함.

* **모니터링 및 보고**

    수정 작업의 성공 여부를 모니터링하고 결과를 보고할 수 있음.

### 구성요소

* **AWS Systems Manager Automation**

    사전 정의된 Automation 문서를 사용하여 수정 작업을 실행함.

* **AWS Lambda**

    사용자 정의 Lambda 함수를 통해 복잡한 수정 작업을 실행함.

* **AWS Config Rules**

    규칙 위반을 감지하고 수정 작업을 트리거함.

### 아키텍처

1. **규칙 설정**

    AWS Config에서 규칙을 설정하고, 해당 규칙에 위반 사항이 발생할 경우 수행할 수정 작업을 정의함.

2. **위반 감지**

    규칙이 위반되면 AWS Config가 이를 감지함.

3. **수정 작업 실행**

    위반 감지 후 정의된 **수정 작업을 AWS Systems Manager Automation 또는 Lambda를 통해 실행**함.

4. **결과 보고**

    수정 작업의 결과를 AWS Config에 보고하여 규정 준수 상태를 모니터링함.

### Use case

* **보안 그룹 규칙 수정**

    잘못된 보안 그룹 규칙을 감지하고 이를 수정하여 올바른 규칙으로 설정함.

* **S3 버킷 정책 수정**

    퍼블릭 액세스가 허용된 S3 버킷을 감지하고 퍼블릭 액세스를 차단함.

* **EC2 인스턴스 설정 변경**

    잘못된 인스턴스 설정을 감지하고 이를 수정하여 올바른 설정으로 변경함.