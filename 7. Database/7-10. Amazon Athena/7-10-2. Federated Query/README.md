# Federated Query

Amazon Athena의 **Federated Query**는 **S3에 저장된 데이터뿐만 아니라 여러 데이터 소스에서 SQL 쿼리를 실행할 수 있도록 지원하는 기능**임. 

이를 통해 사용자는 **Amazon S3, relational databases (RDS, Aurora 등), NoSQL 데이터베이스 (DynamoDB 등), 그리고 온프레미스 데이터 소스** 등 다양한 데이터 소스에서 데이터를 통합하여 쿼리할 수 있음.

## 작동 방식

Athena Federated Query는 **AWS Lambda 함수를 사용하여 데이터 소스와 통합**됨. 

Lambda 함수는 **Athena와 외부 데이터 소스 간의 인터페이스(Connector) 역할**을 하며, 외부 데이터 소스로부터 데이터를 가져와 Athena에 반환함. 

사용자는 표준 SQL을 사용하여 여러 데이터 소스에 대해 쿼리를 실행할 수 있음.

## 구성 요소

### Data Source Connector

**Lambda 기반의 커넥터**로, 각 데이터 소스에 대한 쿼리 실행을 지원함.

### Athena Data Catalog

모든 **데이터 소스의 메타데이터를 관리**하며, 쿼리를 실행할 때 필요한 테이블 스키마 정보를 제공함.

### AWS Lambda

데이터 소스와 Athena 사이의 중간 계층으로 작동하여 데이터를 가져오고 변환함.

## 장점

* **데이터 소스 통합**

    **여러 데이터 소스를 단일 인터페이스로 통합**하여 쿼리할 수 있음.

* **확장성**

    Lambda를 활용한 **서버리스 아키텍처로, 필요에 따라 확장 가능**함.

* **비용 효율성**

    **사용한 만큼만 비용을 지불하는 AWS Lambda와 Athena의 요금 구조**를 통해 비용 절감 가능.

* **데이터 이동 최소화**

    데이터를 복사하거나 이동하지 않고 실시간으로 쿼리할 수 있음.

## 단점

* **설정 복잡성**

    각 데이터 소스에 대한 **커넥터를 설정하고 관리**해야 함.

* **성능 저하 가능성**

    외부 데이터 소스의 네트워크 대기 시간 및 Lambda 실행 시간에 따라 쿼리 성능이 저하될 수 있음.

* **제한된 커넥터**

    **모든 데이터 소스에 대해 지원되지 않을 수 있으며**, 사용자 정의 커넥터가 필요할 수 있음.

## 사용 시기

* **여러 데이터 소스에서 데이터를 통합하여 분석**해야 하는 경우.

* **데이터 이동 및 복사를 최소화**하고 실시간으로 다양한 데이터 소스를 쿼리하고자 할 때.

* 서버리스 아키텍처를 활용하여 확장성과 비용 효율성을 극대화하고자 할 때.

## Architecture Example

![federated query architecture](https://github.com/user-attachments/assets/05dd82d7-da99-4991-a53f-97bd8b647a80)

## Summary

Amazon Athena의 Federated Query는 다양한 데이터 소스를 통합하여 실시간 분석을 가능하게 하는 강력한 도구임. 

이를 통해 사용자는 데이터 소스를 이동하거나 복사하지 않고도 SQL 쿼리를 통해 인사이트를 도출할 수 있음.