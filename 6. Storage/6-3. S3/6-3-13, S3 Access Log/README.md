# [S3 Access Log](https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/LogFormat.html)

## S3 Access Log

* Amazon S3 Access Log는 **S3 버킷에 대한 모든 액세스 요청을 기록하는 기능**임.  
* 이를 통해 누가, 언제, 어떤 방식으로 데이터를 액세스했는지, 거부 되었는지를 추적할 수 있음.

* **로그 파일**  
  * 각 액세스 요청에 대한 정보가 저장된 파일.
* **대상 버킷**(Target Bucket)  
  * 액세스 로그 파일이 저장되는 버킷.
  * 소스 버킷과 **같은 AWS Region**에 위치해야 함.
* **주의할 점**  
  * log가 기록되는 logging bucket에 대한 감시를 진행하면 **무한 루프**로 진행되어 bucket의 크기가 무제한으로 커질 수 있음.

### 기능

* **로그 활성화**  
  * S3 버킷에 대한 액세스 로깅을 활성화할 수 있음.
  * 로그는 JSON 또는 CSV 형식으로 저장됨.

* **로그 정보**  
  * 요청자, 요청 시간, 요청 유형, 응답 상태, 전송된 바이트 수 등 다양한 정보 포함.

### 로그 형식

* 로그 파일은 각 요청에 대한 자세한 정보를 포함하며, 일반적으로 다음과 같은 형식을 가짐.

  ```sh
  79a59df900b4 192.0.2.3 - - [03/Jul/2020:12:00:00 +0000] "GET /my-bucket/my-object HTTP/1.1" 200 434 "-" "Mozilla/5.0"
  ```
  * 79a59df900b4: 요청자의 ID.
  * 192.0.2.3: 요청자의 IP 주소.
  * [03/Jul/2020:12:00:00 +0000]: 요청 시간.
  * GET: 요청 방식 (HTTP 메서드).
  * /my-bucket/my-object: 요청된 리소스.
  * 200: HTTP 상태 코드.
  * 434: 응답의 바이트 수.
  * "Mozilla/5.0": User-Agent 헤더.

### 장점

* **추적 가능성**  
모든 액세스 요청을 기록하여 문제 발생 시 원인 분석 가능.
* **보안 강화**  
비정상적인 액세스 패턴을 감지하여 보안 위협 대응.

### 단점

* **비용 증가**  
많은 양의 로그가 생성되면 저장 비용이 증가할 수 있음.
* **관리 복잡성**  
로그 파일을 분석하고 관리하는데 추가적인 리소스가 필요함.

### Use Case

* **보안 감사**  
  * 누가 버킷에 접근했는지 확인하여 보안 침해를 감지할 수 있음.
  * 비정상적인 접근 시도를 식별하고 대응 가능.

* **비용 관리**  
  * 어떤 요청이 많은 비용을 초래하는지 파악 가능.
  * 불필요한 액세스 요청을 줄임으로써 비용 절감.

* **성능 최적화**  
  * 빈번한 요청 패턴을 분석하여 캐싱 전략 등을 최적화할 수 있음.
  * 성능 병목 현상을 식별하여 개선 가능.

## Example Architecture

* **로그 저장 버킷 구성**  
  * 액세스 로그 파일을 저장할 별도의 버킷을 생성하고, 적절한 권한 설정.
  * 로그 파일이 지정된 접두사로 저장됨.

* **로그 분석**
  * AWS Athena, Amazon Redshift 등을 사용하여 로그 데이터를 쿼리하고 분석.
  * CloudWatch Logs 및 ElasticSearch와 같은 서비스를 활용하여 실시간 모니터링 가능.

## Summary

* Amazon S3 Access Log는 **데이터 액세스 활동을 추적하고 분석할 수 있는 강력한 도구**임.  
* 이를 통해 보안 감사, 비용 관리, 성능 최적화 등의 다양한 이점을 얻을 수 있음.  
* 하지만 로그 데이터를 관리하고 분석하는데 **추가적인 리소스가 필요할 수 있으므**로, 이를 고려하여 설계하고 운영해야 함.