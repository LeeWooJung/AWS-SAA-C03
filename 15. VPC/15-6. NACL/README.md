# [NACL](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-network-acls.html)

## <img src = "https://github.com/user-attachments/assets/5f787bbb-4d16-4b01-b82b-f7dca25ef7e7" width = "25" height = "25"> Network Access Control List

AWS의 네트워크 액세스 제어 목록(NACL, Network Access Control List)은 **VPC(Virtual Private Cloud) 내에서 서브넷 단위로 트래픽을 제어하는 보안 레이어**임. 

NACL은 **서브넷 수준에서 인바운드 및 아웃바운드 트래픽을 허용하거나 거부하는 규칙을 정의**할 수 있음. 

새로 생성되는 Subnet은 **기본 NACL**(Default NACL)에 할당됨.

이는 보안 그룹(Security Groups)과 함께 사용되어 VPC 내의 네트워크 트래픽을 세밀하게 제어할 수 있도록 함.

NACL은 **상태 비저장**(stateless) 방식으로 동작하여, **트래픽이 들어오고 나갈 때 각각의 요청을 개별적으로 평가**함.

## 특징

### 상태 비저장(stateless)

NACL은 **트래픽의 상태를 저장하지 않으며**, 인바운드와 아웃바운드 트래픽을 각각 **독립적으로 평가**함.

### 서브넷 단위 적용

NACL은 **서브넷에 적용되어 해당 서브넷으로 들어오거나 나가는 모든 트래픽을 제어**함.

### 규칙 번호 순서 적용

NACL의 규칙은 **번호 순서대로 평가되며, 가장 먼저 일치하는 규칙이 적용**됨.

규칙 번호는 1부터 32766까지 있으며, 낮은 숫자가 우선적으로 평가됨.

100 단위로 Rule의 번호를 증가시키는 것이 권장됨.

NACL에서의 **마지막 Rule**은 Asterisk(*)로 표현되며 **모든 규칙이 맞아 떨어지는 것이 없다**는 뜻으로 요청을 거절함.

* **Example**

    100번 Rule이 10.0.0.10/32를 Allow, 200번 Rule이 10.0.0.10/32를 Deny 한다면 10.0.0.10/32 IP 주소는 허용됨.

### Default NACL

새로 생성되는 NACL은 우선 모든 트래픽을 **거부**함. 하지만, **Default NACL**은 이와 **연관된 Subnet에서의 Inbound/Outbound를 모두 허용**함.

Default NACL은 수정하지 않는 것이 좋음. 그 대신, Custom NACL을 생성해야함.


### 여러 규칙 설정 가능

각 NACL에는 **여러 개의 인바운드 및 아웃바운드 규칙을 설정**할 수 있음.

## 구성요소

* **NACL**

    VPC 내 서브넷에 연결되어 트래픽을 제어하는 **네트워크 액세스 제어 목록**.

* **인바운드 규칙**

    서브넷으로 들어오는 트래픽을 제어하는 규칙 세트.

* **아웃바운드 규칙**

    서브넷에서 나가는 트래픽을 제어하는 규칙 세트.

* **규칙 번호**

    **규칙의 우선순위를 결정하는 번호**. 
    
    낮은 번호의 규칙이 먼저 평가됨.

* **프로토콜**

    **규칙이 적용될 트래픽의 프로토콜**(TCP, UDP, ICMP 등).

* **포트 범위**

    규칙이 적용될 트래픽의 포트 범위.

* **소스/목적지 CIDR**

    규칙이 적용될 트래픽의 소스 또는 목적지 IP 주소 범위.

* **허용/거부 액션**

    트래픽을 허용(allow)하거나 거부(deny)하는 액션.

## 아키텍처

### NACL 생성

VPC 내에서 하나 이상의 NACL을 생성함.

### 규칙 정의

인바운드 및 아웃바운드 트래픽에 대한 규칙을 정의하고 순서대로 번호를 지정함.

### 서브넷 연결

NACL을 서브넷에 연결하여 해당 서브넷의 트래픽을 제어함.

### 트래픽 평가

서브넷으로 들어오거나 나가는 트래픽은 NACL의 규칙에 따라 평가됨.

## Use case

* **보안 강화**

    특정 서브넷의 트래픽을 세밀하게 제어하여 보안을 강화함.

* **규정 준수**

    규정 준수를 위해 특정 트래픽만 허용하거나 거부하는 규칙을 설정함.

* **네트워크 분할**

    **네트워크를 분할**하여 각 서브넷 간의 트래픽을 제어함.

## vs. Security Group

|Security Group|NACL|
|:---|:---|
|인스턴스 레벨에에서 작동|Subnet 레벨에서 작동|
|Allow Rules만 허용|Allow, Deny Rules 모두 허용|
|**Stateful**: Return 하는 Traffic을 룰에 관계없이 자동으로 허용|**Stateless**: Return 하는 Traffic에 대해서도 Rule에 부합하는지 확인|
|Traffic을 허용할지 결정하기 전에 **모든 규칙**이 평가됨|Traffic을 허용할지 결정할 때 **규칙 번호**순서대로 평가됨. 규칙에 부합하는 것이 있으면, 뒷 규칙은 확인하지 않음|
|하나의 EC2 인스턴스에 적용됨|Subnet에 존재하는 모든 EC2 인스턴스에 자동으로 적용됨|

## Summary

AWS의 네트워크 액세스 제어 목록(NACL)은 VPC 내 **서브넷 단위로 트래픽을 제어하는 보안 레이어**임. 

**상태 비저장 방식**으로 동작하여 인바운드 및 아웃바운드 트래픽을 각각 독립적으로 평가하고, **서브넷 수준에서 규칙을 정의하여 트래픽을 허용하거나 거부**함. 

NACL은 보안 그룹과 함께 사용하여 **다중 보안 레이어를 구성**할 수 있으며, 세밀한 제어와 추가 보안 레이어 제공 등의 장점이 있음. 

그러나 **상태 비저장으로 인한 한계와 규칙 관리의 복잡성 등의 단**도 존재함. 

주요 사용 사례로는 보안 강화, 규정 준수, 네트워크 분할 등이 있음.